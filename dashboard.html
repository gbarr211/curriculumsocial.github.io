<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Curriculum Social</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #1a73e8;
            --secondary-blue: #4285f4;
            --primary-green: #34a853;
            --secondary-green: #66bb6a;
            --light-blue: #e8f0fe;
            --light-green: #e6f4ea;
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            color: #333;
            background: linear-gradient(135deg, #e8f0fe 0%, #e6f4ea 100%);
            min-height: 100vh;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
        }
        
        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn-secondary {
            background-color: var(--primary-green);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-secondary:hover {
            background-color: var(--secondary-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn-outline {
            border: 2px solid var(--primary-blue);
            color: var(--primary-blue);
            background-color: transparent;
            padding: 10px 22px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-outline:hover {
            background-color: var(--light-blue);
        }
        
        .card {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            background: white;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.1);
        }
        
        .text-primary {
            color: var(--primary-blue);
        }
        
        .text-secondary {
            color: var(--primary-green);
        }
        
        .nav-link {
            position: relative;
            padding: 8px 16px;
            margin: 0 8px;
            font-weight: 500;
            color: #4a5568;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 50%;
            background-color: var(--primary-blue);
            transition: all 0.3s;
            transform: translateX(-50%);
        }
        
        .nav-link:hover {
            color: var(--primary-blue);
        }
        
        .nav-link:hover::after {
            width: 80%;
        }
        
        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--primary-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            margin-right: 1.5rem;
        }
        
        .user-avatar img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .loading {
            text-align: center;
            padding: 4rem;
            font-size: 1.2rem;
            color: var(--primary-blue);
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .dashboard-item {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: all 0.3s;
        }
        
        .dashboard-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.1);
        }
        
        .dashboard-item i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-green);
        }
        
        .dashboard-item h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-blue);
        }
        
        .dashboard-item p {
            color: #666;
            margin-bottom: 1.5rem;
        }
        
        .welcome-banner {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .user-details h2 {
            font-size: 2rem;
            color: var(--primary-blue);
            margin: 0;
        }
        
        .user-details p {
            color: #666;
            margin: 0.5rem 0 0 0;
            text-transform: capitalize;
        }

        @media (max-width: 768px) {
            .user-info {
                flex-direction: column;
                text-align: center;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="sticky top-0 bg-white z-50 shadow-sm">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center">
                <h1 class="text-2xl font-bold text-primary">
                    <a href="/" style="text-decoration: none; color: inherit;">
                        <span class="text-secondary">Curriculum</span> Social
                    </a>
                </h1>
            </div>
            <nav class="hidden md:flex">
                <a href="/" class="nav-link">Home</a>
                <a href="profile.html" class="nav-link">Profile</a>
                <a href="matching.html" class="nav-link">Find Families</a>
                <a href="#" class="nav-link" id="dashboardLink">Dashboard</a>
            </nav>
            <div>
                <button id="signOutBtn" class="btn-outline hidden md:inline-block">Sign Out</button>
                <button class="md:hidden text-gray-700">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Loading State -->
    <div id="loadingState" class="loading">
        <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
        <p>Loading your dashboard...</p>
    </div>

    <!-- Main Dashboard Content -->
    <main id="dashboardContent" class="container mx-auto px-4 py-8" style="display: none;">
        <!-- Welcome Banner -->
        <div class="welcome-banner">
            <div class="user-info">
                <div style="display: flex; align-items: center;">
                    <div class="user-avatar" id="userAvatar">
                        U
                    </div>
                    <div class="user-details">
                        <h2 id="userName">Welcome!</h2>
                        <p id="userRole">Loading...</p>
                        <p id="userEmail" style="color: #999; font-size: 0.9rem;"></p>
                    </div>
                </div>
                <div>
                    <button id="editProfileBtn" class="btn-secondary">Edit Profile</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Content Area -->
        <div id="roleSpecificContent">
            <!-- Content will be loaded dynamically based on user role -->
        </div>
    </main>

    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loadingState = document.getElementById('loadingState');
            const dashboardContent = document.getElementById('dashboardContent');
            const signOutBtn = document.getElementById('signOutBtn');
            const editProfileBtn = document.getElementById('editProfileBtn');
            
            // Check authentication state
            window.firebaseAuth.onAuthStateChanged(window.auth, async (user) => {
                if (user) {
                    await loadUserDashboard(user);
                } else {
                    // Redirect to login if not authenticated
                    window.location.href = 'login.html';
                }
            });
            
            async function loadUserDashboard(user) {
                try {
                    // Get user profile from Firestore
                    const profileResult = await window.curriculumSocial.getUserProfile(user.uid);
                    
                    if (profileResult.success) {
                        const userData = profileResult.data;
                        displayUserInfo(user, userData);
                        displayRoleSpecificContent(userData.role);
                        
                        // Hide loading, show dashboard
                        loadingState.style.display = 'none';
                        dashboardContent.style.display = 'block';
                    } else {
                        // Profile doesn't exist - create basic profile
                        const role = prompt("Welcome! Please select your role:\n1. parent\n2. teacher\n3. venue\n\nEnter one of the above:");
                        
                        if (role && ['parent', 'teacher', 'venue'].includes(role.toLowerCase())) {
                            await window.curriculumSocial.createUserProfile(user.uid, {
                                email: user.email,
                                displayName: user.displayName || user.email.split('@')[0],
                                role: role.toLowerCase(),
                                emailVerified: user.emailVerified,
                                photoURL: user.photoURL
                            });
                            location.reload();
                        } else {
                            alert('Please select a valid role');
                            await window.curriculumSocial.signOut();
                            window.location.href = 'login.html';
                        }
                    }
                } catch (error) {
                    console.error('Error loading dashboard:', error);
                    showError('Error loading dashboard. Please try refreshing the page.');
                }
            }
            
            function displayUserInfo(user, userData) {
                const userName = document.getElementById('userName');
                const userRole = document.getElementById('userRole');
                const userEmail = document.getElementById('userEmail');
                const userAvatar = document.getElementById('userAvatar');
                
                userName.textContent = `Welcome, ${userData.displayName || 'User'}!`;
                userRole.textContent = `${userData.role || 'member'} • Member since ${new Date(userData.createdAt?.toDate() || new Date()).toLocaleDateString()}`;
                userEmail.textContent = user.email;
                
                if (userData.photoURL) {
                    userAvatar.innerHTML = `<img src="${userData.photoURL}" alt="Profile Picture">`;
                } else {
                    userAvatar.textContent = (userData.displayName || 'U').charAt(0).toUpperCase();
                }
            }
            
            function displayRoleSpecificContent(role) {
                const contentArea = document.getElementById('roleSpecificContent');
                let content = '';
                
                switch(role) {
                    case 'parent':
                        content = `
                            <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; font-size: 1.8rem;">Parent Dashboard</h3>
                            <div class="dashboard-grid">
                                <div class="dashboard-item">
                                    <i class="fas fa-child"></i>
                                    <h3>My Children</h3>
                                    <p>Manage your children's profiles, track their progress, and view their learning activities.</p>
                                    <button class="btn-primary" onclick="goToStudents()">Manage Students</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-users"></i>
                                    <h3>Find Families</h3>
                                    <p>Connect with like-minded families in your area based on educational philosophy and interests.</p>
                                    <a href="matching.html" class="btn-primary">Start Matching</a>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-calendar-alt"></i>
                                    <h3>Activities & Events</h3>
                                    <p>Browse and join local educational activities, field trips, and social events.</p>
                                    <button class="btn-primary" onclick="goToActivities()">View Activities</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                    <h3>Find Teachers</h3>
                                    <p>Discover qualified teachers for specialized subjects and one-on-one sessions.</p>
                                    <button class="btn-primary" onclick="goToTeachers()">Browse Teachers</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-book"></i>
                                    <h3>Curriculum Resources</h3>
                                    <p>Access our library of educational materials, assessments, and learning tools.</p>
                                    <button class="btn-primary" onclick="goToCurriculum()">Browse Resources</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-comments"></i>
                                    <h3>Messages</h3>
                                    <p>Communicate with other families, teachers, and venue hosts in your network.</p>
                                    <button class="btn-primary" onclick="goToMessages()">View Messages</button>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'teacher':
                        content = `
                            <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; font-size: 1.8rem;">Teacher Dashboard</h3>
                            <div class="dashboard-grid">
                                <div class="dashboard-item">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                    <h3>My Classes</h3>
                                    <p>View and manage your current classes, student rosters, and session schedules.</p>
                                    <button class="btn-primary" onclick="goToClasses()">Manage Classes</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-calendar-plus"></i>
                                    <h3>Create Session</h3>
                                    <p>Schedule new teaching sessions, workshops, or educational activities.</p>
                                    <button class="btn-primary" onclick="createSession()">Add Session</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-users"></i>
                                    <h3>My Students</h3>
                                    <p>Track student progress, provide feedback, and manage learning assessments.</p>
                                    <button class="btn-primary" onclick="goToStudents()">View Students</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-dollar-sign"></i>
                                    <h3>Earnings</h3>
                                    <p>Track your teaching income, view payment history, and manage compensation.</p>
                                    <button class="btn-primary" onclick="goToEarnings()">View Earnings</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-file-alt"></i>
                                    <h3>Resources</h3>
                                    <p>Create and share educational materials, lesson plans, and teaching resources.</p>
                                    <button class="btn-primary" onclick="goToResources()">Manage Resources</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-star"></i>
                                    <h3>Reviews</h3>
                                    <p>View feedback from parents and students to improve your teaching approach.</p>
                                    <button class="btn-primary" onclick="goToReviews()">View Reviews</button>
                                </div>
                            </div>
                        `;
                        break;
                        
                    case 'venue':
                        content = `
                            <h3 style="color: var(--primary-blue); margin-bottom: 1.5rem; font-size: 1.8rem;">Venue Host Dashboard</h3>
                            <div class="dashboard-grid">
                                <div class="dashboard-item">
                                    <i class="fas fa-home"></i>
                                    <h3>My Venues</h3>
                                    <p>Manage your registered venues, update information, and view venue status.</p>
                                    <button class="btn-primary" onclick="goToVenues()">Manage Venues</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-plus-circle"></i>
                                    <h3>Add New Venue</h3>
                                    <p>Register a new space for educational activities and community events.</p>
                                    <button class="btn-primary" onclick="addVenue()">Add Venue</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-calendar-check"></i>
                                    <h3>Bookings</h3>
                                    <p>View upcoming reservations, manage availability, and coordinate with organizers.</p>
                                    <button class="btn-primary" onclick="goToBookings()">View Bookings</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-dollar-sign"></i>
                                    <h3>Revenue</h3>
                                    <p>Track venue rental income and view payment history from bookings.</p>
                                    <button class="btn-primary" onclick="goToRevenue()">View Revenue</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-shield-alt"></i>
                                    <h3>Safety & Compliance</h3>
                                    <p>Maintain safety certifications, insurance, and venue compliance status.</p>
                                    <button class="btn-primary" onclick="goToSafety()">Safety Info</button>
                                </div>
                                <div class="dashboard-item">
                                    <i class="fas fa-chart-line"></i>
                                    <h3>Analytics</h3>
                                    <p>View venue usage statistics, popular time slots, and booking trends.</p>
                                    <button class="btn-primary" onclick="goToAnalytics()">View Analytics</button>
                                </div>
                            </div>
                        `;
                        break;
                        
                    default:
                        content = `
                            <div class="dashboard-item" style="text-align: center; max-width: 600px; margin: 0 auto;">
                                <i class="fas fa-user-circle"></i>
                                <h3>Complete Your Profile</h3>
                                <p>Please update your profile information to access role-specific features and connect with the community.</p>
                                <button class="btn-primary" onclick="goToProfile()">Complete Profile</button>
                            </div>
                        `;
                }
                
                contentArea.innerHTML = content;
            }
            
            function showError(message) {
                alert(message);
            }
            
            // Event listeners
            signOutBtn.addEventListener('click', async () => {
                try {
                    await window.curriculumSocial.signOut();
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Error signing out:', error);
                }
            });
            
            editProfileBtn.addEventListener('click', () => {
                window.location.href = 'profile.html';
            });
            
            // Navigation functions (placeholders for now)
            window.goToStudents = () => window.location.href = 'profile.html#students';
            window.goToActivities = () => window.location.href = 'activities.html';
            window.goToTeachers = () => alert('Teacher directory coming soon!');
            window.goToCurriculum = () => alert('Curriculum library coming soon!');
           window.goToMessages = () => window.location.href = 'matching.html';
            window.goToClasses = () => alert('Class management coming soon!');
            window.createSession = () => alert('Session creation coming soon!');
            window.goToEarnings = () => alert('Earnings tracking coming soon!');
            window.goToResources = () => alert('Resource management coming soon!');
            window.goToReviews = () => alert('Review system coming soon!');
            window.goToVenues = () => alert('Venue management coming soon!');
            window.addVenue = () => alert('Add venue form coming soon!');
            window.goToBookings = () => alert('Booking system coming soon!');
            window.goToRevenue = () => alert('Revenue tracking coming soon!');
            window.goToSafety = () => alert('Safety management coming soon!');
            window.goToAnalytics = () => alert('Analytics dashboard coming soon!');
            window.goToProfile = () => window.location.href = 'profile.html';
        });
    </script>
    
    <!-- Firebase configuration -->
    <script type="module" src="js/firebase-config.js"></script>
</body>
</html>
